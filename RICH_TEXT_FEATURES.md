# 富文本功能说明

## 功能概述

现在平台的所有文本框都支持富文本编辑功能，用户可以使用丰富的格式化选项来创建更美观和结构化的内容。

## 支持的富文本功能

### 基本格式化
- **粗体** (`<strong>`, `<b>`)
- *斜体* (`<em>`, `<i>`)
- <u>下划线</u> (`<u>`)
- ~~删除线~~ (`<s>`, `<strike>`, `<del>`)

### 标题
- H1, H2, H3, H4, H5, H6 标题

### 列表
- 无序列表 (`<ul>`, `<li>`)
- 有序列表 (`<ol>`, `<li>`)

### 其他元素
- 段落 (`<p>`)
- 换行 (`<br>`)
- 引用块 (`<blockquote>`)
- 代码块 (`<pre>`, `<code>`)
- 水平线 (`<hr>`)
- 链接 (`<a>`)
- 图片 (`<img>`)
- 表格 (`<table>`, `<tr>`, `<td>`, `<th>`)

## 受影响的页面

以下页面的文本框现在都支持富文本编辑：

1. **上传作品页面** (`/upload`)
   - 作品内容
   - 翻译期待
   - 翻译要求

2. **编辑作品页面** (`/edit_work/<work_id>`)
   - 作品内容
   - 翻译期待
   - 翻译要求

3. **翻译页面** (`/translate/<work_id>`)
   - 翻译内容

4. **编辑翻译页面** (`/edit_translation/<work_id>`)
   - 翻译内容

5. **作品详情页面** (`/work/<work_id>`)
   - 作品评论内容
   - 翻译评论内容
   - 校正评论内容
   - 修正内容
   - 修正备注
   - 评价内容
   - 拒绝理由
   - 管理员编辑理由
   - 管理员删除理由

6. **对话页面** (`/conversation/<user_id>`)
   - 消息内容

7. **个人资料编辑页面** (`/edit_profile`)
   - 个人简介

8. **申请管理员页面** (`/apply_admin`)
   - 申请理由

9. **管理员请求页面** (`/admin_requests`)
   - 审核备注
   - 拒绝理由

10. **其他页面**
    - 确认翻译页面
    - 发起请求页面

## 安全特性

### HTML清理
- 所有用户输入的内容都会经过HTML清理
- 只允许安全的HTML标签和属性
- 自动移除危险的脚本和事件处理器
- 防止XSS攻击

### 允许的HTML标签
```html
p, br, strong, b, em, i, u, s, strike, del,
h1, h2, h3, h4, h5, h6,
ul, ol, li,
blockquote, pre, code,
a, img,
div, span,
table, thead, tbody, tr, th, td,
hr
```

### 允许的属性
- 链接: `href`, `title`, `target`
- 图片: `src`, `alt`, `title`, `width`, `height`
- 表格: `border`, `cellpadding`, `cellspacing`
- 单元格: `colspan`, `rowspan`
- 通用: `class`, `id`, `style`

## 技术实现

### 前端
- 使用 TinyMCE 6 富文本编辑器
- 支持多语言界面
- 响应式设计
- 工具栏包含常用格式化选项

### 后端
- 使用 `bleach` 库进行HTML清理
- 自定义清理函数 `clean_html_content()`
- 安全的HTML标签白名单
- 防止恶意代码注入

### 数据库
- 内容以HTML格式存储
- 保持原有的数据库结构
- 向后兼容纯文本内容

## 使用方法

1. 在支持富文本的文本框中，您会看到富文本编辑器工具栏
2. 选择文本后使用工具栏按钮进行格式化
3. 支持键盘快捷键（如 Ctrl+B 粗体）
4. 可以插入链接、图片等元素
5. 内容会自动保存为安全的HTML格式

## 注意事项

1. **图片上传**: 图片需要先上传到服务器，然后插入到编辑器中
2. **链接安全**: 外部链接会自动添加安全属性
3. **内容长度**: 富文本内容可能比纯文本更长，请注意内容长度限制
4. **兼容性**: 所有现代浏览器都支持此功能
5. **移动端**: 在移动设备上编辑器会自动适配触摸操作

## 故障排除

如果富文本编辑器没有显示：
1. 检查网络连接（TinyMCE从CDN加载）
2. 清除浏览器缓存
3. 检查浏览器控制台是否有JavaScript错误
4. 确保浏览器支持现代JavaScript特性

## 更新日志

- **2024-01-XX**: 初始版本，集成TinyMCE富文本编辑器
- 支持所有主要页面的富文本编辑
- 实现安全的HTML清理机制
- 添加多语言支持
